id: java.servlets.security.servletresponse-writer-xss-deepsemgrep.servletresponse-writer-xss-deepsemgrep
message: 'Untrusted input could be used to tamper with a web page rendering, which
  can lead to a Cross-site scripting (XSS) vulnerability. XSS vulnerabilities occur
  when untrusted input executes malicious JavaScript code, leading to issues such
  as account compromise and sensitive information leakage. Ensure your data is properly
  encoded using org.owasp.encoder.Encode.forHtml: `Encode.forHtml($VAR)`.'
severity: ERROR
metadata:
  likelihood: HIGH
  impact: MEDIUM
  confidence: HIGH
  interfile: true
  category: security
  subcategory:
  - vuln
  cwe:
  - 'CWE-79: Improper Neutralization of Input During Web Page Generation (''Cross-site
    Scripting'')'
  cwe2021-top25: true
  cwe2022-top25: true
  functional-categories:
  - web::source::cookie::Servlet
  - web::source::http-params::Servlet
  - web::source::http-body::Servlet
  - web::source::header::Servlet
  - web::sink::direct-response::Servlet
  owasp:
  - A07:2017 - Cross-Site Scripting (XSS)
  - A03:2021 - Injection
  references:
  - https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)
  - https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
  - https://portal.securecodewarrior.com/#/learning-resources/application_security_weaknesses~2Fweb~2Fdata_handling~2Fxss~2Fstored
  - https://portal.securecodewarrior.com/#/learning-resources/application_security_weaknesses~2Fweb~2Fdata_handling~2Fxss~2Freflected
  source-rule-url: https://find-sec-bugs.github.io/bugs.htm#XSS_SERVLET
  technology:
  - java
  - servlets
  license: Copyright 2023 Semgrep, Inc.
  vulnerability_class:
  - Cross-Site-Scripting (XSS)
  source: https://semgrep.dev/r/java.servlets.security.servletresponse-writer-xss-deepsemgrep.servletresponse-writer-xss-deepsemgrep
  shortlink: https://sg.run/vJN0
  semgrep.dev:
    rule:
      r_id: 40133
      rv_id: 111597
      rule_id: EwUYz4
      version_id: BjTXplp
      url: https://semgrep.dev/playground/r/BjTXplp/java.servlets.security.servletresponse-writer-xss-deepsemgrep.servletresponse-writer-xss-deepsemgrep
      origin: pro_rules
languages:
- java
mode: taint
pattern-sources:
- patterns:
  - pattern-either:
    - pattern: '(HttpServletRequest $REQ).$REQFUNC(...)

        '
    - pattern: "(ServletRequest $REQ).$REQFUNC(...) \n"
  - metavariable-regex:
      metavariable: $REQFUNC
      regex: (getInputStream|getParameter|getParameterMap|getParameterValues|getReader|getCookies|getHeader|getHeaderNames|getHeaders|getPart|getParts|getQueryString)
pattern-sinks:
- patterns:
  - pattern-either:
    - pattern: '(PrintWriter $WRITER).write($STR, ...);

        '
    - pattern: '$RESP.getWriter().write($STR, ...);

        '
  - focus-metavariable: $STR
pattern-sanitizers:
- pattern-either:
  - pattern: Encode.forHtml(...)
  - pattern: (PolicyFactory $POLICY).sanitize(...)
  - pattern: (AntiSamy $AS).scan(...)
  - pattern: Jsoup.clean(...)
  - pattern: new Cleaner(...).clean(...)
  - pattern: '(Cleaner $CL).clean(...)

      '
